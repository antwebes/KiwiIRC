<script type="text/javascript">

    kiwi.plugins.on('loaded', function(){





		$(".main").append($('<li class="right-menu-btn"><i class="fa fa-align-justify" title="Open Menu"></i> Menu</li>'));


    	

    	window.update_right_menu = function () {
    		var items = window.right_menu_items || [];
    		var itemsLength = items.length;

    		$(".right-menu").remove();

			$(".main").append($( "<div class='right-menu'><ul class='right-menu-items'></ul></div>"));



			$(".right-menu-btn").click(function () {
				$('.right-menu').mmenu().trigger( "open.mm" );
			});

    		

			for (var i = 0; i < itemsLength; i++) {
				$(".right-menu-items").append(generateRightMenuItem(items[i]));
			}

			$('.right-menu').mmenu({
			   counters	: true,
			   searchfield	: true,
			   "offCanvas": {
			      "position": "right"
			   }
	        }).on("click", "a[href=\"#\"]",
				function(event) {
					if(event.target.innerText != undefined) {
						 if(typeof ga !== 'undefined')  ga('send', 'event', 'right_menu', event.target.innerText);
					}
					return true;
				}
			);
    	}
		
		generateRightMenuItem = function(item) {
			if(item.submenu == undefined && item.type != "Toggle"){
				var itemStr = '<li><a href="#"><i class="fa fa-'+item.icon+'"></i> ' + item.name + '</a></li>';
			} else {
				var itemStr = '<li><span><i class="fa fa-'+item.icon+'"></i> ' + item.name + '</span></li>';
			}

			var $itemMenu = $(itemStr);
			var $clickItem = $itemMenu;



			if(item.type == "Toggle") {
				if(item.default) {
					$itemMenu.append('<input type="checkbox" checked class="Toggle" />');
				} else {
					$itemMenu.append('<input type="checkbox" class="Toggle" />');
				}
				$clickItem = $("input", $itemMenu);
				
			}


			if(item.command != undefined) {
				$clickItem.click(function () {
					var input = kiwi.components.ControlInput();
	            	input.run(item.command);
				});				
			}


			if(item.submenu != undefined){
				$itemMenu.append("<ul />");
				var itemsSubmenuLength = item.submenu.length;
				for (var i = 0; i < itemsSubmenuLength; i++) {
		 			$("ul", $itemMenu).append(generateRightMenuItem(item.submenu[i]));
				}

			}


			return $itemMenu;
		}


		window.update_right_menu();

    });
</script>

