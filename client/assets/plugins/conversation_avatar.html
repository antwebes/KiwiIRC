<script type="text/javascript">
    (function($){
        kiwi.plugins.on('loaded', function(){
            var network = kiwi.components.Network();
            var input = kiwi.components.ControlInput();

            $('body').bind("DOMSubtreeModified", function(obj){
                if(obj.target.className == 'messages'){
                    $(obj.target).find('.nick').each(function(){
                        var $elem = $(this);

                        if($elem.parent().hasClass('privmsg')) {
                            var nick = $elem.text().replace(/^\s+|\s+$/gm, '');
                            var img = window.getAvatarFromNick(nick);

                            if (img) {
                                $imgTag = $elem.find('.avatar');

                                if ($imgTag.length > 0 && $imgTag.attr('src') != img.src) {
                                    $imgTag.attr('src', $imgTag.src)
                                } else if ($imgTag.length == 0) {
                                    $elem.prepend('<img width="20" height="20" class="usericon avatar" src="' + img.src + '"> ');
                                }
                            } else {
                                $elem.prepend('<i class="meicon fa fa-user avatar"></i> ');
                            }
                        }
                    });
                }
            });
        });
    })(jQuery);
</script>