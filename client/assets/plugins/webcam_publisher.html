
<script type="text/javascript">
    (function () {
        var network = kiwi.components.Network();
        var control = kiwi.components.ControlInput();
 
        var $icon = $('<strong style="cursor:pointer; cursor: hand">WebCam</strong>');

        function onJqueryUILoaded(callback){
            if(typeof jQuery.ui == 'undefined') {
                var headTag = document.getElementsByTagName("head")[0];
                var jqTag = document.createElement('script');
                jqTag.type = 'text/javascript';
                jqTag.src = '//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js';
                jqTag.onload = callback;

                var jqlinkTag = document.createElement('link');
                jqlinkTag.rel = 'stylesheet';
                jqlinkTag.href = '//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/smoothness/jquery-ui.css';
                jqlinkTag.onload = function(){
                    headTag.appendChild(jqTag);
                }

                headTag.appendChild(jqlinkTag);
            } else {
                 callback();
            }
        }

        var $content;
        var $webcam;

        function openWebcam(){
            onJqueryUILoaded(function(){
                var myNick = kiwi.panels().active.get('network').get('nick');

                $content = $('<div>');

                $webcam = $('<iframe />', {
                    name: 'webcam_publisher',
                    id:   'webcam_publisher',
                    width: "100%",
                    height: "100%",
                    frameborder: "no",
                    scrolling: "no",
                    src: 'http://webcam.chatsfree.net/publisher.html?nick='+ myNick
                }).appendTo($content);


                $content.dialog({
                    autoOpen: true,
                    width: 610,
                    minWidth: 610,
                    height: 450,
                    minHeight: 200,
                    modal: false,
                    resizable: true,
                    draggable: true,
                    close: closeWebcam

                });
            });
        }

        function closeWebcam(){
            $content.dialog('close');
            $webcam.remove();
            $content = null;
        }
 
        $icon.click(function(){
            if($content){
                closeWebcam();
            }else{
                openWebcam();
            }
        });
 
        control.addPluginIcon($icon);
    })();
</script>