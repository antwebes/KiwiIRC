<script type="text/javascript">
    (function(){
        kiwi.events.on('loaded', function(){
            var network = kiwi.components.Network();
            var input = kiwi.components.ControlInput();


            network.on('message:notice', function(event) {
                if(typeof window.token == 'undefined'){
                    return;
                }

                if(event.nick.toLowerCase() == 'nickserv' || event.nick.toLowerCase() == 'nick') {
                    if(
                            event.msg.indexOf("nickname is registered and protected.")  > -1 ||
                            event.msg.indexOf("nick está registrado y protegido.")  > -1
                    ){
                        network.msg(event.nick, 'identifyoauth '+window.token);
                    }
                    console.log(event);
                }
            });


            network.on('message:message', function(event) {
                if(typeof window.token == 'undefined'){
                    return;
                }
                
                if(event.nick.toLowerCase() == 'nickserv' || event.nick.toLowerCase() == 'nick') {
                    if(
                            event.msg.indexOf("nickname is registered and protected.")  > -1 ||
                            event.msg.indexOf("nick está registrado y protegido.")  > -1
                    ){
                        network.msg(event.nick, 'identifyoauth '+window.token);
                    }
                }
            });

            if (getQueryVariable('nick')) {
                var nick = getQueryVariable('nick');

                $('#server_select_nick').val(nick);
            }

            if (getQueryVariable('channel')) {
                var channels = getQueryVariable('channel').split(',');
                channels = channels.map(function (channel) {
                    return channel;
                });

                $('.server_select').hide();
                $('#server_select_channel').val(channels.join(','));
            }

            if (getQueryVariable('private')) {
                var private = getQueryVariable('private');

                $('.server_select').hide();

                network.on('connect', function () {
                    input.run('/query ' + private);

                    //To show panel active chat room chatsfree
                    if (kiwi.connections.active_connection.panels.getByName('#chatsfree')) {
                        kiwi.connections.active_connection.panels.getByName('#chatsfree').view.show()
                    } else {
                        kiwi.connections.active_connection.panels.find(function (panel) {
                            return panel.isChannel();
                        }).view.show();
                    }
                });
            }

            if (getQueryVariable('channel') || getQueryVariable('private')) {
                $('[data-js=submit]').click();
            }
        });
    })();
</script>