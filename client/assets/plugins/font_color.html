<script type="text/javascript">

    (function () {
        var stylHtml = "<style>" +
            "#color-picker li {" +
            "    list-style: none;" +
            "    float: left;" +
            "    width: 20px;" +
            "}" +

            "#color-picker ul {" +
            "    width: 80px;" +
            "    position: absolute;" +
            "}" +
        "</style>";

        var iconsTmpl = '<div id="color-picker" class="tool">\n' +
            '<img src="/kiwi/assets/img/color_picker.png">\n' +
            '<ul>\n' +
                '<li data-color="0" style="background-color: #FFFFFF">&nbsp;</li>\n' +
                '<li data-color="1" style="background-color: #000000">&nbsp;</li>\n' +
                '<li data-color="2" style="background-color: #000080">&nbsp;</li>\n' +
                '<li data-color="3" style="background-color: #008000">&nbsp;</li>\n' +
                '<li data-color="4" style="background-color: #FF0000">&nbsp;</li>\n' +
                '<li data-color="5" style="background-color: #800040">&nbsp;</li>\n' +
                '<li data-color="6" style="background-color: #800080">&nbsp;</li>\n' +
                '<li data-color="7" style="background-color: #FF8040">&nbsp;</li>\n' +
                '<li data-color="8" style="background-color: #FFFF00">&nbsp;</li>\n' +
                '<li data-color="9" style="background-color: #80FF00">&nbsp;</li>\n' +
                '<li data-color="10" style="background-color: #008080">&nbsp;</li>\n' +
                '<li data-color="11" style="background-color: #00FFFF">&nbsp;</li>\n' +
                '<li data-color="12" style="background-color: #0000FF">&nbsp;</li>\n' +
                '<li data-color="13" style="background-color: #FF55FF">&nbsp;</li>\n' +
                '<li data-color="14" style="background-color: #808080">&nbsp;</li>\n' +
                '<li data-color="16" style="background-color: #C0C0C0">&nbsp;</li>\n' +
            '</ul>\n' +
        '</div>\n';

        var network = kiwi.components.Network();
        var control = kiwi.components.ControlInput();
        var selected_color = null;
        var $area = $("#kiwi .controlbox textarea");

        var $icon = $(iconsTmpl);
        var $colors = $icon.find('ul');

        var setColorsPosition = function() {
            $colors.css('top', (-($icon.position().top + $icon.height() + 80))+'px');
        };

        $(styleHtml).appendTo($('head'));

        $colors.hide();

        $icon.click(function(e){
            e.stopPropagation();

            $colors.show();
        });

        //we need to hide the color box every time we click outside of the color list
        $(document).click(function() {
            $colors.hide();
        });

        $colors.find('li').click(function(e){
            e.stopPropagation();

            $this = $(this);
            $area.css('color', $this.css('background-color'));
            selected_color = $this.data('color');
            $this.parent().hide();
        });

        $area.keydown(function(e){
            var code = e.keyCode || e.which;

            if(code == 13 && selected_color){
                $area.val('\x03'+selected_color+$area.val());
            }
        });

        control.addPluginIcon($icon);
        setColorsPosition();
    })();
</script>